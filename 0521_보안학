# 침입 방지 시스템



## 장비(Hardware)

## 동작 원리

## 설치위치 

  방화벽 뒤에 설치하는 것이 효과적

 ## VPN(Virtal Private Network)

  일반적 보안 솔루션 - 고가의 임대회선 대신에 인터넷 회선을 임대 회선처럼 사용할 수 있게 해주는 솔루션

## VPN활용

  해외 여행 중 국내 온라인 게임에 접속하는 경우 등 원거리 네트워크에서 보안으로 활용

## VLAN

  네트워크를 작은 네트워크로 임의로 나눈 네트워크

  각 네트워크 별 접근 통제 등 별도 정책 적용 가능

  



# 암호학

정보를 보호하기 위한 언어학적 및 수학적 방법론을 다루는 학문



### 암호학적 서비스의 목표

##### 암호 시스템의 구성요소

평문 / 암호문 / 암호화 알고리즘 / 복호화 알고리즘 / 키

##### 암호학에서 사용하는 이름

* Alice - 메시지 송신자
* Bob - 메시지 수신자
* Eve - 도청자, 소극적인 공격자
* Mallory - 악의를 가진 적극적인 공격자
* Trent - 신뢰할 수 있는 중재자
* VIctor - 검증자

##### 암호화

* 평문 - 암호화 전의 메시지

* 암호문 - 평문을 암호화한 후의 메시지
* 암호화 - 
* 암호화 키 -
* 복호화 - 암호문을 평문으로 복원하는 행위
* 복호화 키 - 
* 암호문 - 
* 해독 - 수신자 이외의 사람이 암호문으로부터 평문이나 비밀키를 도출하기 위해 시도하는 행위

##### 암호공격 방법

* 암호문 공격
* 알려진 평문 공격
* 선택된 평문 공격
* 선택된 암호문 공격
* COA - 암호 공격 시 공격자가 가장 불리한 공격방식, 암호문만 가진채로 평문이나 키를 찾아야 하는 상황
* KPA - 암호문에 대응하는 일부 평문이 존재, 복호키를 찾는 것 이 목표, 암호문과 알려진 평문 사이의 관계로 부터 키와 전체 평문을 추정하여 해독
* CPA - 평문을 선택하면 대응하는 암호문을 얻을 수 있는 상황, 또한 그런 암호화기를 보유한 상황, 암호화 키를 찾는 것이 목표, 가장 이상적 해독 환경, 비밀키를 찾을 수 있는 평문을 예상해서 입력
* CCA - 암호문을 선택하면 대응하는 평문을 얻을 수 있는 상황, 암호문에 대한 복호화기가 있는 경우, 암호문을 임의로 조합해 가면서 복호화 과정을 관찰하고 복호화 키를 도출한다.



###  암호 기법의 분류



##### 데이터에 따른 분류

* 텍스크 기반 암호화 - 전치, 치환 
* 암호 / 바이너리 기반 암호화 - 스트림 암호, 블록 암호

##### 암호화 키에 따른 분류 

* 대칭키 암호화 방식 - 암호화에 사용된 키와 복호화 시 사용되는 키가 동일한 암호화 방식, 암호키 관리 및 전달이 관건, DES, 3DES, AES 등
* 비 대칭키 암호화 방식 - 암호화에 사용된 키와 복호화에 사용되는 키가 다른 암호화 방식, 공개키 암호화 방식이라고도 함, 키 관리가 편리한 장점, RSA, DF, ECC 등
* 하이브리드 암호화 방식 - 대칭키 방식과 공개키 방식의 장점을 조합한 암호화 방식

##### 적용 위치에 따른 암호화 분류

* 종단간 암호화 - 사용자 또는 어플리케이션이 직접 암호화 수행
* 링크 암호화 - 전송 매체 및 네트워크 장비에서 암호화

##### 암호화 시스템에 따른 분류

소프트웨어/하드웨어 암호화



### 암호화 방식



#### 전치법

메시지에 들어있는 문자 위치를 바꾸는 방법

암호문과 평문의 문자세트가 동일

미리정해둔 문자 배열 규칙으로 암호화와 복호화 수행

##### 전치암호의 예

Rail Fence Cipher - 보내고 싶은 평문을 Rail에 한 글자씩 배치하는 방법

Route cipher - 컬럼의 수를 정하고 메시지를 컬럼에 맞게 적은 후 재배열



#### 키가 있는 전치 암호

##### 대체법(치환법)

* 메시지의 글자를 다른 글자로 대체하여 암호화 하는 것
* 평문 문자 집합과, 암호문의 문자 집합이 다를 수 있음
* 모든 전치 암호는 치환 암호
* 단일 치환 - 한 글자가 다른 글자로 대체

##### 시저 암호

* 고대 로마의 줄리어스 시저가 사용했다고 전해지는 암호화 방식
* 평문으로 사용되는 알파벳을 일정한 문잦 수 만큼 평행이동 시켜서 암호화
* 평문을 한 문자씩 암호화
* 단일 치환 암호의 약점은 빈도분석

##### 에니그마

* 날짜별 키와 통신키의 이중키 사용
* 메시지는 통신키로 암호화 / 통신키는 날짜별 키로 암호화

##### Steganography

* 그림이나 파일에 일정한 그림이나 문자 혹은 문서를 변환 삽입
* 메시지 존재 자체를 은폐하는 방식
* 문자 마킹
* 보이지 않는 잉크
* 핀 구멍
* 타자 수정 리본

##### 바이너리 기반 암호화

* 컴퓨터의 발달로 인해 기존 텍스트 방식의 암호화는 안정성이 떨어짐
* 컴퓨터를 이용한 더 복잡한 암호화 / 복화화를 수행하는 방식이 개발
* 스트림 암호 - 입력 데이터의 순서대로 암호화를 처리, 평무놔 키 스트림을 XOR연산하여 암호문 생성, 블록 암호화 방식보다 빠르지만 강도는 약함, 음성, 오디오/비디오 스트리밍 및 무선 암호화에 사용
* 블록 암호 - 특정 개수의 비트들을 모아 하나의 블록으로 처리, 평문을 일정한 크기의 블록으로 잘라낸 후 암호화 알고리즘 적용, Round를 통해 암호화를 반복 적용하여 암호화 강도를 높일 수 있음, DES, AES 등

##### XOR 연산

* 텍스트 데이터 스트림 암호화 과정
* 텍스트 데이터 - 비트 스트림으로 변환 - 키 스트림과 XOR 연산

##### DES

* 미국의 연방 정보 처리 표준규격(FIPS)으로 채택된 대칭 암호 알고리즘
* 64비트 단위로 데이터를 처리 : 64비트 데이터를 64비트로 암호화
* 56비트의 키를 사용 (56비트 키 + 8비트)

##### DES 동작원리

평문에서 64비트 추출 - 초기 치환 - 좌우분리 - 16라운드 진행 - 역치환 - 암호블록 완성

##### DES 취약점

키 길이가 56비트 밖에 되지 않아 전사 공격에 취약점 발견

##### AES

* 128비트의 블록 방식 암호 알고리즘
* 키의 길이는 128비트, 192비트, 256비트 선택 사용
* 10, 12, 14라운드 각각 진행
* 평문을 128비트로 나누고 4*4 행렬로 배치하여 라운드 진행







 ### 시스템 보안 개요

시스템 보안이란 END-POINT 시스템 차원에서의 침입 방지 대책

네트워크에 연결된 시스템의 운영체제, 응용 프로그램, 서버 등의 취약점을 관리하는 것.



#### 시스템 보안의 6가지 핵심

* 계정 관리 - 허락된 사용자만 시스템 사용 가능
* 세션 관리 - 허락된 시간 만큼만 시스템 사용 가능
* 접근 제어 - 허락된 경로로만 접근 가능
* 권한 관리 - 특정 자원에 대해 허락된 행위만 가능
* 로그 관리 - 의심되는 행위는 모두 로깅
* 취약점 관리 - 주기적인 점검 및 업데이트로 최상의 상태 유지

 ##### 계정 관리

* 계정 - 시스템에 접근하는 가장 기본적인 방법, 보통 아이디와 패스워드로 관리
* 계정의 식별 - 지문인식, 홍체인식 등은 그 자체가 그 사람임을 입증, 아이디 자체는 사용자 식별 기능이 없음, 해당 사용자만 알고있는 패스워드로 보안해야함
* 계정의 관리  - 불필요한 계정에 대한 주기적인 관리, 불필요한 권한이 부여되었는지 검사하고 관리, 계정에 패스워드를 사용, 취약한 패스워드가 사용되지 않도록 관리

##### 계정의 종류

* 운영체제 계정
* 응용 프로그램 계정
* 특정 서비스 계정
* 테이터베이스 계정
* 네트워크 장비 계정
* 그룹 계정

대부분 운영체제는 계정을 그룹별로 묶어서 관리

* 관리자 계정 - 다른 사용자 계정 과리, 시스템 관리, 어플리케이션 동작 관리
* 일반 사용자 계정 - 제한된 권한을 가지는 계정
* 게스트 계정 / 익명 계정 - 일시적인 접속을 위한 계정
* 기타 특수 목적용 계정 - 특정 어플리케이션 수행을 위한 계정

##### 패스워드 관리

패스워드는 가장 기본적인 인증방법이면서 공격자 입장에서는 가장 쉬우면서 강력한 공격 수단

적절한 강도를 가진 상태로 설정 되어야 하고, 패스워드 정책에 따라 적절히 보호되어야 함

* 부적절한 패스워드 - 길이가 너무 짧거나 널(Null)인 패스워드, 사전에 나오는 단어나 그 조합 또는 변형, 키보드 자판의 일련 나열, 사용자 계정 정보로 유추할 수 있는 단어
* 적절한 패스워드 - 기억하기 쉽지만 크래킹하기 어려운 패스워드

##### 패스워드 정책

패스워드를 자주 바꾸도록 유도하는 정책 필요

패스워드 설정 정책 적용 - 패스워드의 길이와 복잡도를 정해두는 것

##### 패스워드 공격 유형

* 사전 대입 공격 - 사용자가 설정하는 대부분의 패스워드에 패턴이 있음에 착안하여 사전이나 쿼티 123456 등 가능성 있는 암호 목록을 만든 후 대입
* 무작위 대입 공격 - 사전 대입 공격이 실패했을 때 사용, 패스워드에 사용될 문자열 범위를 정하고 무작위 대입(전수 대입),   패스워드가 복잡하지 않다면 단시간 내 해독 가능
* 레인보우 테이블을 이용한 공격 - 해시로 변환된 문자열 목록을 가지고 있고 암호 파일에 동일한 해시값이 있으면 암호 획득, 해시값을 모두 저장하기에는 용량이 크므로 해시 파일 용량을 줄이는 것이 관건





###  세션 관리



##### 세션의 의미

사용자와 시스템 사이 또는 두 시스템 사이의 활성화된 접속, 한번 인증된 사용자에게 일정시간 인증 상태를 유지해 주는 것

##### 세션 관련 공격

세션 하이재킹 - 사용자의 계정정보를 몰라도 이미 연결된 세션 정보를 탈취해서 시스템에 접근하는 공격 방식

##### 세션 관리 방법

일정시간 로그온 상태를 유지시켜주되 타임아웃을 두어 계정이 탈취되지 않도록 지원

##### 접근 제어

특정 요청에 대해 허가 또는 거부하는 프로세스

적절한 권한을 가진 인가자만 특정 시스템이나 정보에 접근하도록 통제하는 것

##### 접근 제어의 예

* 호스트 정책 - 정해진 호스트에서만 접근 가능
* 정 / IP 정책 - 정해진 계정 및 IP에서만 접근 가능
* 시간 / 요일 정책 - 정해진 시간 및 요일에만 접근 가능
* 프로토콜 정책 - 정해진 프로토콜로만 접근 가능
* OTP 이중 인증 - 정해진 2차 인증수단으로 한번 더 인증

##### 접근 제어 방법

계정 정보를 통해 접근 통제, 접근 이력에 대한 기록 및 관리

접근할 수 있는 인터페이스 제한 - 신뢰할 수 있는 인터페이스만 허용

* 암호화된 채널 사용 - telnet 대신 ssh 사용
* 방화벽을 통한 접근 차단
* 네트워크 장비를 통한 접근제어

##### 권한 관리

운영체제의 파일과 디렉토리에 대한 접근 권한에 대한 관리

권한관리의 중요성 - 시스템 해킹의 첫 번쨰 목표는 권한 획득, 해킹이란 원하는 수준의 권한을 획득하여 무언가를 수행하는 것

권한 - 읽기, 생성 및 수정, 실행

##### 권한 적용 규칙

접근권한은 누적된다.

파일 접근 권한이 디렉토리 접근 권한보다 우선이다.

허용보다 거부가 우선된다.

##### 응용 프로그램 권한 관리

모든 응용 프로그램은 운영체제에 존재하는 어떤 계정에 의해 실행됨

응용 프로그램의 취약점이 노출되면 해당 응용프로그램을 실행한 계정이 탈취당하게 됨



### 로그 관리



##### 로그

시스템에서 발생한 각종 이벤트에 대해 시간과 내용을 기록한 것, 목적에 따라 시스템 로그, 사용자 로그 등으로 나눌 수 있음

##### 로그 관리의 의미

시스템의 취약점을 제거해 최상의 상태로 운영하는 것이 최선, 하지만 언제든지 새로운 취약점이 발견될 수 있고, 업데이트가 나오기 전에 공격이 시작되는 Zero day attack의 위험성도 있음

##### AAA

시스템의 사용자가 로그인하여 명령을 내리는 모든 과정은 AAA로 구분할 수 있음

AAA는 로깅의 주요 대상

식별 및 인증 - 자신의 신원을 시스템에 증명하는 것 (ID/PW)

인가

책임

##### 책임 추적성

추적에 대한 기록의 충실도, 좋은 로그는 책임 추적성이 높은 로그, 보안과 관련된 로그는 시간대 별 이벤트를 상세하게 기록 해둬야 함

로그의 주요 내용 - 종류, 날짜, 시간, 원본, 범주, 이벤트, 사용자, 컴퓨터





 ### 취약점 관리

보안설정을 아무리 잘해도 시스템 자체에 취약점이 존재하면 이를 막는것은 어렵다, 운영체제나 어플리케이션 공급자가 제공하는 패치를 적용하는 것이 최선.



##### 백도어

* 트로이목마 - 정상적인 프로그램으로 위장, 내부에 악성 코드
* 백도어 - 정상적인 인증 과정을 무시하고 OS나 프로그램에 접근하는 통로
* 백도어 탐지 - 현재 동작중인 프로세스 확인, 열린 포트 확인, 바이러스 및 백도어 탐지 툴 이용, 무결성 검사(MDS 해시 기법) 등
* 바이러스 / 웜 - 바이러스나 웜은 운영체제 및 어플리케이션의 취약점을 공격하는 가장 대표적인 예



- [x] 이번 시간의 주요 요점은 시스템보안, 네트워크보안의 각 보더라인을 잘 아는 것.

시스템 관리에는 ~세션들이 있다. 정도





# 시스템 보안 실습



#### 윈도우 계정 관리

cmder을 관리자 권한으로 실행해서 입력 - cmder 인터페이스 우측 하단에 메뉴에서  active - restart - admin 눌러서 실행 가능

$ net user

$ net localgroup administrators

$ net localgroup users



------------가상머신 내-------------- Window 10 기준

##### 제어판 - 관리도구 -  컴퓨터 관리 - 사용자 어쩌구 - 새 유저 만들기

Administrator 뺴고는 계정관리를 못함, 주기적으로 계정 상태를 갱신해주어야 보안을 유지할 수 있다.

Administrator 라는 이름은 취약하기 때문에 이 이름부터 바꾸어주고 시작하는 것이 옳음



##### 제어판 - 관리도구 - 로컬 보안 정책 - 로컬 정책 - 보안 옵션

계정: Administrator 계정 이름 바꾸기 실행

덧붙혀 게스트 계정은 사용 안하는 것이 보안에 좋음

##### 계정 정책 - 암호 정책

암호 생성시 지킬 정책들을 설정할 수 있음

복잡성 정책 - 사용자의 계정 이름이나 연속되는 2글자 금지 등 다양

##### 계정 정책 - 계정 잠금 정책

세션 관리와 관련이 있음.



방화벽 관리 시험 문제에 나옴



##### 폴더 속성 - 보안 탭


사용자 별로 디렉터리 권한을 설정할 수 있다.

##### 사용자 권한 할당 정책

로컬 보안 정책 - 로컬 정책 - 사용자 권한 할당

로컬 보안 정책 - 로컬 정책 - 네트워크에서 이 컴퓨터 엑세스 거부

로컬에서 로그인 거부

시스템 강제 종료 권한

##### 로컬 정책 - 보안 옵션

대화형 로그온: 마지막 로그인 사용자 이름 표시 안 함 기능도 있음



### 로컬 보안 정책 - 로깅

##### 감사 정책(로깅 정책)

로컬 정책 - 감사 정책

여러 로그를 남기는 프로세스를 적용할 수 있음

##### 개체 액세스 검사

로컬 보안 정책  - 감사 정책 - 개체 엑세스 검사

로컬 보안 정책  - 감사 정책 - 계정 관리 감사

프로세스 추적 감사 - 운영체제에서 수행되는 프로세스 로깅 가능

##### 이벤트 뷰어

로깅한 것과 운영체제 내 여러 이벤트를 볼 수 있음

#####  윈도우 세션 관리

##### 세션 정보 확인

$ net session



### 윈도우 서비스 관리

##### 윈도우 서비스(데몬)이란?

백그라운드로 계속 돌고 있는 프로그램을 말함

제어판 - 서비스



##### 윈도우 방화벽 관리

방화벽 상태 확인 - 제어판 - 방화벽 상태 확인

앱 또는 기능 허용 확인을 해주어야 함 - 한번 앱이나 기능을 허용하면 다른 포트를 사용하더라도 계속 접속이 가능하기 때문에 조심해야한다.

##### 새로운 인바운드 규칙 추가(실습 중요)

방화벽 상태 확인 - 고급 보안 - 인바운드 규칙

내가 프로그램을 만들었을 때 이유없이 안돼는 이유는 위의 인바운드 규칙에서 막고있는 포트를 쓰고 있을 가능성이 높다. 문제가 발견되면 우회할 방법을 찾아야 한다.

방화벽 상태 확인 - 고급 보안 - 인바운드 규칙 - 새 규칙 - 포트 or 사용자 지정 선택 - 모든 프로그램 - tcp - 특정 포트 - 1500 - 다음 - 연결 허용 - 이름 : tcp 5000 인바운드



###  레지스트리 관리

윈도우의 설정 정보들을 관리할 수 있음

시작 -레지스트리 편집기



### 윈도우 업데이트 및 관리

######  바이러스 검사

 시작 - 바이러스 및 위협 방지

##### 윈도우 업데이트

 시작 - 윈도우 업데이트

##### 윈도우 보안 점검 툴

 Microsoft Baseline security analyzer

##### 메모리 덤프 분석

 메모리 덤프

현재 시스템의 상태가 그대로 저장된 파일

윈도우 시스템이 예기치 않게 종료될 경우 시스템에서 자동으로 생성

메모리 덤프 파일을 분석하면, 시스템이 어디서 오류가 발생했는지 디버깅이 가능

windbg 프로그램으로 가능

 메모리 덤프 생성

작업관리자 - 프로세스 탭 - 프로그램 우클릭 후 덤프파일 만들기

이 작업으로 덤프파일을 분석하여 오점을 찾아낼 수 있음
